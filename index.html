<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Isle: Prime Elder Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0a0c0f;
            color: #d1d5db;
            background-image: radial-gradient(circle at center, #1a202c 0%, #0a0c0f 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex: 1;
        }
        .glass-panel {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        .checkbox-custom {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #10b981;
        }
        .progress-glow {
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
        select, input[type="text"] {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(75, 85, 99, 0.5);
        }
        .hidden-objective {
            display: none !important;
        }
        .dino-preview-img {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .dino-preview-img:hover {
            transform: scale(1.1);
        }
        .isle-logo {
            filter: drop-shadow(0 0 8px rgba(16, 185, 129, 0.3));
            max-width: 180px;
        }
        #privacy-modal, #rename-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 50;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0c0f;
        }
        ::-webkit-scrollbar-thumb {
            background: #1f2937;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #10b981;
        }
        .social-icon {
            transition: all 0.2s ease;
            color: #9ca3af;
        }
        .social-icon:hover {
            color: #10b981;
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="p-2 md:p-6 lg:p-8">

    <!-- Privacy Modal -->
    <div id="privacy-modal">
        <div class="glass-panel max-w-md w-full rounded-2xl p-8 border-emerald-500/30">
            <h2 class="text-xl font-bold text-emerald-500 mb-4">Data & Privacy Notice</h2>
            <p class="text-sm text-gray-300 mb-4 leading-relaxed">
                To keep track of your dinosaur's progress, this website saves your profiles to your browser's <strong>Local Storage</strong>.
            </p>
            <ul class="text-xs text-gray-400 space-y-2 mb-6 list-disc pl-4">
                <li>No data is sent to a server.</li>
                <li>No personal information is collected.</li>
                <li>If you clear your browser cache, your progress will be lost.</li>
            </ul>
            <button onclick="acceptPrivacy()" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 rounded-xl transition-all">
                I Understand
            </button>
        </div>
    </div>

    <!-- Rename Modal -->
    <div id="rename-modal">
        <div class="glass-panel max-w-sm w-full rounded-2xl p-6 border-emerald-500/30">
            <h2 class="text-[10px] font-bold uppercase tracking-widest text-emerald-500 mb-4">Edit Dino Nickname</h2>
            <input type="text" id="modal-nickname-input" placeholder="e.g. Alpha Male, Solo Run..." class="w-full rounded-lg p-3 text-sm text-emerald-400 font-bold outline-none border border-emerald-500/40 mb-6 bg-black/60">
            <div class="flex gap-3">
                <button onclick="closeRenameModal()" class="flex-1 text-gray-400 hover:text-white text-xs font-bold uppercase py-2">Cancel</button>
                <button onclick="saveNicknameFromModal()" class="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold uppercase py-2 rounded-lg transition-all">Save Name</button>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto main-content">
        <header class="flex flex-row items-center justify-between mb-6 gap-4">
            <div class="flex items-center gap-4">
                <img src="https://www.theisle-game.com/templates/yootheme/cache/8f/The-Isle-Skull-copy-8f195f17.webp" alt="The Isle Logo" class="isle-logo">
                <div class="hidden md:block h-12 w-px bg-emerald-500/30"></div>
                <div class="hidden md:block">
                    <h1 class="text-xl font-bold text-emerald-500 tracking-widest uppercase">Prime Elder Pursuit</h1>
                    <p class="text-gray-500 text-[10px] uppercase font-bold tracking-tighter opacity-70">Lineage Eligibility Tracker</p>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <div class="text-right hidden sm:block">
                    <span id="counter" class="text-2xl font-mono text-emerald-400">0/5</span>
                    <p class="text-[10px] uppercase font-bold text-gray-500">Run Progress</p>
                </div>
                <div class="w-24 h-24 bg-black/50 rounded-xl border border-gray-700 overflow-hidden flex items-center justify-center relative group shrink-0">
                    <img id="dino-image" src="" alt="Dino Preview" class="dino-preview-img w-full h-full object-contain p-2 hidden" onerror="imageLoadError()">
                    <div id="image-placeholder" class="text-gray-600 text-[8px] text-center p-1 uppercase font-bold">
                        No Image
                    </div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Column: Profile & Settings -->
            <div class="lg:col-span-4 space-y-4">
                <div class="glass-panel rounded-2xl p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-[10px] font-bold uppercase tracking-widest text-gray-500">Active Profile</h2>
                        <button onclick="createNewProfile()" class="text-emerald-500 hover:text-emerald-400 text-[10px] font-bold uppercase transition-colors">+ New Dino</button>
                    </div>
                    
                    <div class="flex gap-2 mb-4">
                        <select id="profile-select" onchange="switchProfile()" class="flex-1 rounded-lg p-2 text-sm text-emerald-400 outline-none">
                        </select>
                        <button onclick="openRenameModal()" class="p-2 bg-emerald-900/20 text-emerald-500 rounded-lg hover:bg-emerald-900/40 transition-colors" title="Rename Dino">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/></svg>
                        </button>
                        <button onclick="deleteCurrentProfile()" class="p-2 bg-red-900/30 text-red-500 rounded-lg hover:bg-red-900/50 transition-colors" title="Delete Profile">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>
                        </button>
                    </div>

                    <div class="space-y-3">
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-gray-500 mb-1 ml-1">Species</label>
                            <select id="dino-species" onchange="updateSpecies()" class="w-full rounded-lg p-2 text-sm text-white outline-none">
                                <option value="" disabled>Select Species...</option>
                                <optgroup label="Carnivores">
                                    <option value="Ceratosaurus">Ceratosaurus</option>
                                    <option value="Deinosuchus">Deinosuchus</option>
                                    <option value="Dilophosaurus">Dilophosaurus</option>
                                    <option value="Herrerasaurus">Herrerasaurus</option>
                                    <option value="Omniraptor">Omniraptor</option>
                                    <option value="Pteranodon">Pteranodon</option>
                                    <option value="Troodon">Troodon</option>
                                    <option value="Tyrannosaurus">Tyrannosaurus Rex</option>
                                </optgroup>
                                <optgroup label="Omnivores">
                                    <option value="Beipiaosaurus">Beipiaosaurus</option>
                                    <option value="Gallimimus">Gallimimus</option>
                                </optgroup>
                                <optgroup label="Herbivores">
                                    <option value="Diabloceratops">Diabloceratops</option>
                                    <option value="Dryosaurus">Dryosaurus</option>
                                    <option value="Hypsilophodon">Hypsilophodon</option>
                                    <option value="Pachycephalosaurus">Pachycephalosaurus</option>
                                    <option value="Stegosaurus">Stegosaurus</option>
                                    <option value="Tenontosaurus">Tenontosaurus</option>
                                    <option value="Triceratops">Triceratops</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-gray-500 mb-1 ml-1">Status & Server</label>
                            <div class="flex gap-2">
                                <select id="life-status" onchange="updateProgress()" class="flex-1 rounded-lg p-2 text-sm text-white outline-none">
                                    <option value="Alive">ðŸŸ¢ Alive</option>
                                    <option value="Dead">ðŸ’€ Dead</option>
                                    <option value="Stored">ðŸ“¦ Stored</option>
                                </select>
                                <input type="text" id="server-name" placeholder="Server Name..." oninput="updateProgress()" class="flex-1 rounded-lg p-2 text-sm text-white outline-none">
                            </div>
                        </div>
                    </div>
                    
                    <button id="manual-save-btn" onclick="manualSave()" class="w-full mt-4 flex items-center justify-center gap-2 bg-emerald-900/40 hover:bg-emerald-800/60 text-emerald-400 text-[10px] font-bold uppercase tracking-widest py-2.5 rounded-xl border border-emerald-500/20 transition-all duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M11 2H9v3h2z"/><path d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0M1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5m3 4.5h7a.5.5 0 0 0 .5-.5V1H4v4.5a.5.5 0 0 0 .5.5M3 15h10v-4.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5z"/></svg>
                        <span>Save to Browser</span>
                    </button>
                </div>

                <div class="glass-panel rounded-2xl p-4">
                    <h2 class="text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-3 text-center">Spawn Type</h2>
                    <div class="flex p-1 bg-black/40 rounded-xl border border-gray-700/50">
                        <button onclick="setSpawn('spawned')" id="btn-spawned" class="flex-1 py-1.5 text-xs font-bold rounded-lg transition-all duration-200 uppercase">Spawn</button>
                        <button onclick="setSpawn('hatched')" id="btn-hatched" class="flex-1 py-1.5 text-xs font-bold rounded-lg transition-all duration-200 uppercase">Hatch</button>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-4">
                    <div class="w-full bg-gray-800 rounded-full h-3 overflow-hidden border border-gray-700 mb-2">
                        <div id="progress-bar" class="h-full bg-emerald-500 transition-all duration-500 ease-out w-0 progress-glow"></div>
                    </div>
                    <p id="status-msg" class="text-center text-[11px] font-bold uppercase tracking-wider text-gray-500">Select objectives...</p>
                    
                    <button onclick="resetCurrentProfile()" class="w-full mt-4 text-red-900/60 hover:text-red-500 transition-colors uppercase tracking-widest font-bold text-[9px] py-1 border border-red-900/20 rounded-lg">Reset Progress</button>
                </div>
            </div>

            <!-- Right Column: Checklist -->
            <div class="lg:col-span-8">
                <div class="glass-panel rounded-2xl overflow-hidden h-full">
                    <div id="checklist-container" class="divide-y divide-gray-700/50">
                        <div id="item-sanctuary"></div>
                        <div id="hatched-hidden-group" class="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-gray-700/50">
                            <div class="divide-y divide-gray-700/50">
                                <div id="item-diet"></div>
                                <div id="item-infertility"></div>
                                <div id="item-spasms"></div>
                                <div id="item-mass"></div>
                            </div>
                            <div class="divide-y divide-gray-700/50">
                                <div class="p-4 bg-white/5">
                                    <div class="flex items-start">
                                        <div class="pt-1">
                                            <input type="checkbox" id="migration-check" class="checkbox-custom rounded border-gray-600 bg-gray-700 pointer-events-none opacity-50">
                                        </div>
                                        <div class="ml-3 flex-1">
                                            <span class="block text-sm font-bold text-gray-200">Migration Goals (2)</span>
                                            <div class="mt-2 flex items-center gap-3">
                                                <input type="number" id="mz-count" value="0" min="0" max="10" onchange="updateProgress()" class="bg-black/40 border border-gray-700 text-emerald-400 font-mono text-lg w-14 rounded-lg p-1 text-center outline-none">
                                                <span class="text-[10px] text-gray-500 font-bold uppercase">Zones Visited</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 bg-white/5">
                                    <div class="flex items-start">
                                        <div class="pt-1">
                                            <input type="checkbox" id="patrol-check" class="checkbox-custom rounded border-gray-600 bg-gray-700 pointer-events-none opacity-50">
                                        </div>
                                        <div class="ml-3 flex-1">
                                            <span class="block text-sm font-bold text-gray-200">Patrol Goals (4)</span>
                                            <div class="mt-2 flex items-center gap-3">
                                                <input type="number" id="pz-count" value="0" min="0" max="10" onchange="updateProgress()" class="bg-black/40 border border-gray-700 text-emerald-400 font-mono text-lg w-14 rounded-lg p-1 text-center outline-none">
                                                <span class="text-[10px] text-gray-500 font-bold uppercase">Zones Visited</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="item-nest"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Social Footer -->
    <footer class="mt-16 pt-8 pb-12 border-t border-gray-800/50 max-w-6xl mx-auto w-full">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
            <!-- Credits -->
            <div class="text-center md:text-left order-2 md:order-1">
                <p class="text-[10px] uppercase font-bold text-gray-500 tracking-widest mb-1">Developer</p>
                <a href="https://github.com/Peinful" target="_blank" class="text-sm font-bold text-gray-300 hover:text-emerald-400 transition-colors flex items-center justify-center md:justify-start gap-1">
                    Made with <span class="text-red-500">â™¥</span> by Pein
                </a>
            </div>

            <!-- Social Links -->
            <div class="flex justify-center gap-6 order-1 md:order-2">
                <a href="https://x.com/PeinfulZ" target="_blank" class="social-icon" title="Twitter">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg>
                </a>
                <a href="https://twitch.tv/PeinfulZ" target="_blank" class="social-icon" title="Twitch">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2H3v16h5v4l4-4h5l4-4V2zm-10 9V7m5 4V7"></path></svg>
                </a>
                <a href="https://www.youtube.com/@PeinfulZ" target="_blank" class="social-icon" title="YouTube">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
                </a>
                <a href="https://discord.gg/hMexN53kc9" target="_blank" class="social-icon" title="Discord">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="12" r="1"></circle><circle cx="15" cy="12" r="1"></circle><path d="M9 17c1 1 3 1 4 0"></path><path d="M22 12c0 5.5-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2s10 4.5 10 10z"></path></svg>
                </a>
            </div>

            <!-- Legal/Disclaimer -->
            <div class="text-center md:text-right order-3">
                <p class="text-[9px] text-gray-600 uppercase tracking-tighter leading-relaxed">
                    Disclaimer: Unconfirmed data. Not affiliated with Afterthought LLC. Data saved locally.
                </p>
            </div>
        </div>
    </footer>

    <script>
        const dinoImages = {
            "Ceratosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/5/5a/CeratosaurusEvrima.png",
            "Deinosuchus": "https://static.wikia.nocookie.net/the-isle-world/images/1/1d/Deinosuchus_Icon.png",
            "Dilophosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/b/b3/Dilo_Evrima.png",
            "Herrerasaurus": "https://static.wikia.nocookie.net/the-isle-world/images/b/b7/Herrerasaurus_Icon.png",
            "Omniraptor": "https://static.wikia.nocookie.net/the-isle-world/images/1/1a/Omniraptor_Icon.png",
            "Pteranodon": "https://static.wikia.nocookie.net/the-isle-world/images/c/c5/Pteranodon_Icon.png",
            "Troodon": "https://static.wikia.nocookie.net/the-isle-world/images/5/5d/Troodon_Icon.png",
            "Tyrannosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/0/06/Tyrannosaurus_Rex_Icon.png",
            "Beipiaosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/1/14/Beipiaosaurus_Icon.png",
            "Gallimimus": "https://static.wikia.nocookie.net/the-isle-world/images/c/c3/Gallimimus_Icon.png",
            "Diabloceratops": "https://static.wikia.nocookie.net/the-isle-world/images/4/4d/Diabloceratops_Icon.png",
            "Dryosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/5/53/Dryosaurus_Icon.png",
            "Hypsilophodon": "https://static.wikia.nocookie.net/the-isle-world/images/1/10/Hypsi_Icon.png",
            "Pachycephalosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/3/3b/Pachy_Icon.png",
            "Stegosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/7/77/Stegosaurus_Icon.png",
            "Tenontosaurus": "https://static.wikia.nocookie.net/the-isle-world/images/c/cd/Tenontosaurus_Icon.png",
            "Triceratops": "https://static.wikia.nocookie.net/the-isle-world/images/4/4e/Triceratops_Icon.png"
        };

        const standardObjectives = [
            { id: 'sanctuary', text: 'Visit Sanctuary', sub: 'Stay for ~10s.' },
            { id: 'diet', text: 'Perfect Diet', sub: 'Balance all nutrients.' },
            { id: 'infertility', text: 'Avoid Infertility', sub: 'Nutrients kept active.' },
            { id: 'spasms', text: 'Avoid Spasms', sub: 'No cannibalism.' },
            { id: 'nest', text: 'Nesting Goal', sub: 'Raise a hatchling to 50%.' },
            { id: 'mass', text: 'Mass Migration', sub: 'Visit primary zone.' }
        ];

        let profiles = JSON.parse(localStorage.getItem('isle_elder_profiles_v9')) || {
            'default': { name: 'Pachycephalosaurus', nickname: '', spawnType: 'spawned', mz: 0, pz: 0, server: '', status: 'Alive', checks: {} }
        };
        let activeId = localStorage.getItem('isle_elder_active_id_v9') || 'default';

        function init() {
            if (!localStorage.getItem('privacy_accepted')) {
                document.getElementById('privacy-modal').style.display = 'flex';
            }
            renderProfileList();
            renderChecklist();
            loadProfile(activeId);
        }

        function acceptPrivacy() {
            localStorage.setItem('privacy_accepted', 'true');
            document.getElementById('privacy-modal').style.display = 'none';
        }

        function manualSave() {
            saveCurrentState();
            const btn = document.getElementById('manual-save-btn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/></svg>
                <span>Profile Saved!</span>
            `;
            btn.classList.replace('bg-emerald-900/40', 'bg-emerald-600');
            btn.classList.replace('text-emerald-400', 'text-white');
            
            setTimeout(() => {
                btn.innerHTML = originalContent;
                btn.classList.replace('bg-emerald-600', 'bg-emerald-900/40');
                btn.classList.replace('text-white', 'text-emerald-400');
            }, 2000);
        }

        function openRenameModal() {
            const p = profiles[activeId];
            document.getElementById('modal-nickname-input').value = p.nickname || '';
            document.getElementById('rename-modal').style.display = 'flex';
            document.getElementById('modal-nickname-input').focus();
        }

        function closeRenameModal() {
            document.getElementById('rename-modal').style.display = 'none';
        }

        function saveNicknameFromModal() {
            const newName = document.getElementById('modal-nickname-input').value;
            profiles[activeId].nickname = newName;
            saveAll();
            renderProfileList();
            closeRenameModal();
        }

        function imageLoadError() {
            document.getElementById('dino-image').classList.add('hidden');
            document.getElementById('image-placeholder').classList.remove('hidden');
        }

        function updateDinoImage(species) {
            const imgEl = document.getElementById('dino-image');
            const placeholder = document.getElementById('image-placeholder');
            const url = dinoImages[species];
            if (url) {
                imgEl.src = url;
                imgEl.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                imageLoadError();
            }
        }

        function renderProfileList() {
            const select = document.getElementById('profile-select');
            select.innerHTML = Object.keys(profiles).map(id => {
                const p = profiles[id];
                const statusEmoji = p.status === 'Dead' ? 'ðŸ’€' : p.status === 'Stored' ? 'ðŸ“¦' : 'ðŸ¦–';
                const displayName = p.nickname ? `${p.nickname} (${p.name})` : p.name;
                return `<option value="${id}" ${id === activeId ? 'selected' : ''}>${statusEmoji} ${displayName}</option>`;
            }).join('');
        }

        function renderChecklist() {
            standardObjectives.forEach(obj => {
                const el = document.getElementById(`item-${obj.id}`);
                if (!el) return;
                el.innerHTML = `
                    <label class="flex items-start p-4 hover:bg-white/5 transition-colors cursor-pointer group">
                        <div class="pt-1">
                            <input type="checkbox" id="${obj.id}" class="checkbox-custom rounded border-gray-600 bg-gray-700" onchange="updateProgress()">
                        </div>
                        <div class="ml-3">
                            <span class="block text-sm font-bold text-gray-200 group-hover:text-emerald-400 transition-colors">${obj.text}</span>
                            <span class="block text-[10px] text-gray-500 uppercase font-medium tracking-tight">${obj.sub}</span>
                        </div>
                    </label>
                `;
            });
        }

        function switchProfile() {
            saveCurrentState();
            activeId = document.getElementById('profile-select').value;
            localStorage.setItem('isle_elder_active_id_v9', activeId);
            loadProfile(activeId);
        }

        function createNewProfile() {
            const species = document.getElementById('dino-species').value || "Pachycephalosaurus";
            const id = 'p_' + Date.now();
            profiles[id] = { name: species, nickname: '', spawnType: 'spawned', mz: 0, pz: 0, server: '', status: 'Alive', checks: {} };
            activeId = id;
            saveAll();
            renderProfileList();
            loadProfile(id);
            openRenameModal();
        }

        function updateSpecies() {
            const species = document.getElementById('dino-species').value;
            profiles[activeId].name = species;
            updateDinoImage(species);
            saveAll();
            renderProfileList();
        }

        function deleteCurrentProfile() {
            if (Object.keys(profiles).length <= 1) return;
            if (confirm(`Delete profile?`)) {
                delete profiles[activeId];
                activeId = Object.keys(profiles)[0];
                saveAll();
                renderProfileList();
                loadProfile(activeId);
            }
        }

        function setSpawn(type) {
            profiles[activeId].spawnType = type;
            const spawnedBtn = document.getElementById('btn-spawned');
            const hatchedBtn = document.getElementById('btn-hatched');
            const hiddenGroup = document.getElementById('hatched-hidden-group');
            
            if (type === 'hatched') {
                hiddenGroup.classList.add('hidden-objective');
                hatchedBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-lg bg-emerald-600 text-white shadow-lg uppercase";
                spawnedBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-lg text-gray-500 hover:text-gray-300 uppercase";
            } else {
                hiddenGroup.classList.remove('hidden-objective');
                spawnedBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-lg bg-emerald-600 text-white shadow-lg uppercase";
                hatchedBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-lg text-gray-500 hover:text-gray-300 uppercase";
            }
            updateProgress();
        }

        function updateProgress() {
            const isHatched = profiles[activeId].spawnType === 'hatched';
            const mz = parseInt(document.getElementById('mz-count').value) || 0;
            const pz = parseInt(document.getElementById('pz-count').value) || 0;
            
            document.getElementById('migration-check').checked = (mz >= 2);
            document.getElementById('patrol-check').checked = (pz >= 4);

            let checkedCount = 0;
            const statusMsg = document.getElementById('status-msg');

            if (isHatched) {
                const sancChecked = document.getElementById('sanctuary').checked;
                checkedCount = sancChecked ? 5 : 0;
                document.getElementById('counter').innerText = sancChecked ? "1/1" : "0/1";
                document.getElementById('progress-bar').style.width = sancChecked ? "100%" : "0%";
                statusMsg.innerText = sancChecked ? "ELDER ELIGIBLE!" : "Visit Sanctuary.";
            } else {
                const checkboxes = document.querySelectorAll('#checklist-container input[type="checkbox"]');
                checkedCount = Array.from(checkboxes).filter(i => i.checked).length;
                const percent = Math.min((checkedCount / 5) * 100, 100);
                document.getElementById('progress-bar').style.width = `${percent}%`;
                document.getElementById('counter').innerText = `${checkedCount}/5`;
                statusMsg.innerText = checkedCount >= 5 ? "ELDER ELIGIBLE!" : `Need ${Math.max(0, 5 - checkedCount)} More`;
            }
            
            statusMsg.className = checkedCount >= 5 ? "text-center text-[11px] font-bold uppercase tracking-widest text-emerald-400 animate-pulse" : "text-center text-[11px] font-bold uppercase tracking-wider text-gray-500";
            saveCurrentState();
        }

        function loadProfile(id) {
            const p = profiles[id];
            document.getElementById('mz-count').value = p.mz || 0;
            document.getElementById('pz-count').value = p.pz || 0;
            document.getElementById('server-name').value = p.server || '';
            document.getElementById('life-status').value = p.status || 'Alive';
            document.getElementById('dino-species').value = p.name;
            updateDinoImage(p.name);
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if (cb.id !== 'migration-check' && cb.id !== 'patrol-check') {
                    cb.checked = p.checks[cb.id] || false;
                }
            });
            setSpawn(p.spawnType || 'spawned');
        }

        function saveCurrentState() {
            const p = profiles[activeId];
            p.mz = document.getElementById('mz-count').value;
            p.pz = document.getElementById('pz-count').value;
            p.server = document.getElementById('server-name').value;
            p.status = document.getElementById('life-status').value;
            p.name = document.getElementById('dino-species').value;
            p.checks = {};
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                p.checks[cb.id] = cb.checked;
            });
            saveAll();
        }

        function saveAll() {
            localStorage.setItem('isle_elder_profiles_v9', JSON.stringify(profiles));
            localStorage.setItem('isle_elder_active_id_v9', activeId);
        }

        function resetCurrentProfile() {
            if(confirm("Clear progress for this dino?")) {
                profiles[activeId].mz = 0;
                profiles[activeId].pz = 0;
                profiles[activeId].checks = {};
                loadProfile(activeId);
                updateProgress();
            }
        }

        window.onload = init;
    </script>
</body>
</html>
